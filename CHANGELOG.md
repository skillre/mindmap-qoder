# 更新日志

## [GitHub集成版] - 2024-01-01

### ✨ 新增功能

#### 🔧 后端服务
- **新增 Express 后端服务器** (`server/`)
  - 基于 Express.js 构建的轻量级API服务
  - 支持 CORS、压缩、安全头设置
  - 请求频率限制和错误处理
  - 健康检查接口

#### 🐙 GitHub API 集成
- **完整的 GitHub API 集成** (`server/routes/github.js`)
  - Token 验证功能
  - 仓库和分支列表获取
  - 文件的 CRUD 操作（创建、读取、更新、删除）
  - 支持私有仓库访问
  - 自动错误处理和重试机制

#### 🎨 前端组件扩展
- **GitHub 配置界面** (`web/src/components/GitHubConfig.vue`)
  - Token 验证和用户信息显示
  - 仓库选择器（支持搜索）
  - 分支选择器
  - 自动保存间隔设置
  - 配置数据本地存储

- **云端文件管理器** (`web/src/components/GitHubFiles.vue`)
  - 文件列表展示和搜索
  - 在线新建、编辑、删除文件
  - 文件下载功能
  - 文件大小显示

- **自动保存状态指示器** (`web/src/components/AutoSaveIndicator.vue`)
  - 实时显示保存状态
  - 最后保存时间显示
  - 自动保存开关状态
  - 暗黑模式适配

#### 💾 数据存储改造
- **Vuex 状态管理扩展** (`web/src/store.js`)
  - GitHub 配置状态管理
  - 当前文件信息追踪
  - 自动保存状态管理
  - 本地存储集成

- **自动保存机制** 
  - 实时数据变更监听
  - 防抖处理避免频繁保存
  - 手动保存功能
  - 保存失败重试机制

#### 🔄 前端API服务
- **GitHub API 客户端** (`web/src/api/github.js`)
  - 统一的API调用封装
  - 自动错误处理和用户提示
  - 请求/响应拦截器
  - 自动文件路径生成

### 🗑️ 移除功能

- **本地文件操作** (`web/src/pages/Edit/components/Toolbar.vue`)
  - 移除"新建文件"按钮
  - 移除"打开文件"按钮  
  - 移除"另存为"按钮
  - 移除本地文件树功能
  - 移除相关的文件操作方法

### 🛠️ 技术改进

#### 🐳 容器化部署
- **多阶段 Dockerfile**
  - `Dockerfile`: 标准生产环境构建
  - `Dockerfile.prod`: 优化的轻量级生产环境
  - `Dockerfile.dev`: 开发环境支持热重载

- **Docker Compose 配置**
  - `docker-compose.yml`: 基础配置
  - `docker-compose.prod.yml`: 生产环境配置
  - `docker-compose.dev.yml`: 开发环境配置
  - 支持 Redis 缓存服务
  - 资源限制和健康检查

#### 🌐 Nginx 配置优化
- **生产环境配置** (`nginx.conf`)
  - 前后端代理设置
  - Gzip 压缩优化
  - 静态资源缓存策略
  - API 请求限流
  - 安全头设置

- **开发环境配置** (`nginx.dev.conf`)
  - 热重载支持
  - WebSocket 代理
  - 调试友好配置

- **HTTPS 配置** (`nginx.https.conf`)
  - SSL/TLS 优化
  - 安全策略强化
  - HTTP 自动重定向

### 📊 性能优化

- **前端优化**
  - 组件懒加载
  - API 请求防抖
  - 状态管理优化
  - 内存泄漏防护

- **后端优化**
  - 连接池复用
  - 请求缓存策略
  - 错误处理优化
  - 资源压缩

- **容器优化**
  - 多阶段构建减小镜像体积
  - Alpine Linux 基础镜像
  - 构建缓存优化
  - 运行时资源限制

### 🔒 安全增强

- **API 安全**
  - 请求频率限制
  - 输入数据验证
  - CORS 配置
  - 安全头设置

- **容器安全**
  - 非 root 用户运行
  - 最小权限原则
  - 安全的基础镜像

### 📚 文档完善

- **部署文档** (`DEPLOYMENT.md`)
  - 详细的部署指南
  - 配置说明
  - 故障排除
  - 性能优化建议

- **测试文档** (`TESTING.md`)
  - 功能测试清单
  - 测试步骤说明
  - 已知问题记录

- **验证脚本** (`validate.sh`)
  - 自动化验证脚本
  - 文件结构检查
  - 语法验证

### 🔧 开发体验

- **环境配置**
  - `.env.production`: 生产环境变量
  - `.env.development`: 开发环境变量
  - 环境隔离和配置管理

- **开发工具**
  - 热重载支持
  - 自动化测试脚本
  - 代码语法检查

### 📈 架构变更

```
原架构: 纯前端应用 → 本地文件系统

新架构: Vue前端 ← API → Express后端 ← GitHub API → GitHub仓库
```

- **前后端分离**: 清晰的职责分工
- **微服务架构**: 模块化设计
- **云原生**: 容器化部署
- **API网关**: Nginx反向代理

### 💡 使用体验提升

- **一键部署**: Docker Compose 支持
- **可视化配置**: 友好的 GitHub 配置界面  
- **状态反馈**: 实时保存状态显示
- **错误处理**: 友好的错误提示和恢复
- **响应式设计**: 支持多种屏幕尺寸

### 🔮 后续计划

- [ ] 支持更多云存储服务（Google Drive、OneDrive等）
- [ ] 协作编辑功能增强
- [ ] 离线模式支持
- [ ] 移动端 APP 开发
- [ ] 数据导出/导入格式扩展
- [ ] 性能监控和分析
- [ ] 多语言支持

---

## 兼容性说明

此 GitHub 集成版本与原版在以下方面存在不兼容：

1. **不再支持本地文件操作**: 所有文件操作现在通过 GitHub API 进行
2. **需要后端服务**: 不再是纯前端应用，需要运行后端服务
3. **部署方式变更**: 推荐使用 Docker 容器化部署
4. **配置要求**: 需要 GitHub Token 和私有仓库

## 迁移指南

如需从原版迁移到 GitHub 集成版：

1. **备份现有数据**: 导出所有本地思维导图文件
2. **准备 GitHub 环境**: 创建私有仓库和 Personal Access Token
3. **部署新版本**: 按照 DEPLOYMENT.md 指南部署
4. **导入数据**: 通过"云端文件"功能上传现有文件
5. **配置自动保存**: 根据需要调整保存设置

## 技术支持

- 📖 [部署指南](./DEPLOYMENT.md)
- 🧪 [测试指南](./TESTING.md)  
- 🐛 [问题反馈](./issues)
- 💬 技术交流群: [加入群聊]